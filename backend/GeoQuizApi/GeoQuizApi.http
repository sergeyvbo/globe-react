@GeoQuizApi_HostAddress = http://localhost:5051

# Variables for testing
@testEmail = testhttp@example.com
@testPassword = TestPassword123
@testName = Test User

@jwtToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1laWQiOiJhZGIxMGIwYi1iOTNlLTRmODUtYjFhZi1lZTViOWU2MDJiMGIiLCJlbWFpbCI6InRlc3RodHRwQGV4YW1wbGUuY29tIiwianRpIjoiNWE5YzBjMzAtNDNmOS00MWZkLTljMWUtMTExNzU0ZWFmYmJlIiwidW5pcXVlX25hbWUiOiJUZXN0IFVzZXIiLCJuYmYiOjE3NTMwMDQyMDcsImV4cCI6MTc1MzAwNTEwNywiaWF0IjoxNzUzMDA0MjA3LCJpc3MiOiJHZW9RdWl6QXBpIiwiYXVkIjoiR2VvUXVpekNsaWVudCJ9.gi2x0K7LGwPm2GzHuffLYfFAK858c2tGWM-qGuj7EK8
@refreshToken = iC6e3lbW2lZT4DehfD62715bDqfo3hKRnnJmkSLt3ZvDWoQunybN5OuZRABszd+VxVQNH5BIs8WL/ePtdxri0w==

### 1. Register a new user
POST {{GeoQuizApi_HostAddress}}/api/auth/register
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}",
  "name": "{{testName}}"
}

### 2. Login with the registered user
POST {{GeoQuizApi_HostAddress}}/api/auth/login
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

### 3. Get current user info (requires valid JWT token)
# Replace YOUR_JWT_TOKEN with the accessToken from login/register response
GET {{GeoQuizApi_HostAddress}}/api/auth/me
Authorization: Bearer {{jwtToken}}
Accept: application/json

### 4. Update user profile (requires valid JWT token)
PUT {{GeoQuizApi_HostAddress}}/api/auth/profile
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "name": "Updated Test User",
  "avatar": "https://example.com/avatar.jpg"
}

### 5. Change password (requires valid JWT token)
PUT {{GeoQuizApi_HostAddress}}/api/auth/change-password
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "currentPassword": "{{testPassword}}",
  "newPassword": "NewPassword123"
}

### 5.1 Change password back
PUT {{GeoQuizApi_HostAddress}}/api/auth/change-password
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "currentPassword": "NewPassword123",
  "newPassword": "{{testPassword}}"
}

### 6. Refresh token
# Replace YOUR_REFRESH_TOKEN with the refreshToken from login/register response
POST {{GeoQuizApi_HostAddress}}/api/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

### 7. Logout (requires valid JWT token and refresh token)
POST {{GeoQuizApi_HostAddress}}/api/auth/logout
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

### 8. Test invalid login
POST {{GeoQuizApi_HostAddress}}/api/auth/login
Content-Type: application/json

{
  "email": "invalid@example.com",
  "password": "wrongpassword"
}

### 9. Test registration with existing email
POST {{GeoQuizApi_HostAddress}}/api/auth/register
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "AnotherPassword123",
  "name": "Another User"
}

### 10. Test registration with invalid email
POST {{GeoQuizApi_HostAddress}}/api/auth/register
Content-Type: application/json

{
  "email": "invalid-email",
  "password": "{{testPassword}}",
  "name": "Test User"
}

### 11. Test registration with weak password
POST {{GeoQuizApi_HostAddress}}/api/auth/register
Content-Type: application/json

{
  "email": "weak@example.com",
  "password": "123",
  "name": "Weak Password User"
}

### 12. Test accessing protected endpoint without token
GET {{GeoQuizApi_HostAddress}}/api/auth/me
Accept: application/json

### 13. Test with expired/invalid token
GET {{GeoQuizApi_HostAddress}}/api/auth/me
Authorization: Bearer invalid.jwt.token
Accept: application/json

### === GAME STATS ENDPOINTS ===

### 14. Save a game session (requires valid JWT token)
POST {{GeoQuizApi_HostAddress}}/api/game-stats
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "gameType": "countries",
  "correctAnswers": 8,
  "wrongAnswers": 2,
  "sessionStartTime": "2025-01-20T10:00:00Z",
  "sessionEndTime": "2025-01-20T10:05:30Z"
}

### 15. Save another game session - flags
POST {{GeoQuizApi_HostAddress}}/api/game-stats
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "gameType": "flags",
  "correctAnswers": 15,
  "wrongAnswers": 5,
  "sessionStartTime": "2025-01-20T11:00:00Z",
  "sessionEndTime": "2025-01-20T11:08:45Z"
}

### 16. Save another game session - states
POST {{GeoQuizApi_HostAddress}}/api/game-stats
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "gameType": "states",
  "correctAnswers": 12,
  "wrongAnswers": 3,
  "sessionStartTime": "2025-01-20T12:00:00Z",
  "sessionEndTime": "2025-01-20T12:06:15Z"
}

### 17. Get user's aggregated statistics (requires valid JWT token)
GET {{GeoQuizApi_HostAddress}}/api/game-stats/me
Authorization: Bearer {{jwtToken}}
Accept: application/json

### 18. Get user's game history (requires valid JWT token)
GET {{GeoQuizApi_HostAddress}}/api/game-stats/me/history
Authorization: Bearer {{jwtToken}}
Accept: application/json

### 19. Get user's game history with pagination
GET {{GeoQuizApi_HostAddress}}/api/game-stats/me/history?page=1&pageSize=5
Authorization: Bearer {{jwtToken}}
Accept: application/json

### 20. Migrate anonymous progress (requires valid JWT token)
POST {{GeoQuizApi_HostAddress}}/api/game-stats/migrate
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "anonymousSessions": [
    {
      "gameType": "countries",
      "correctAnswers": 6,
      "wrongAnswers": 4,
      "sessionStartTime": "2025-01-19T15:00:00Z",
      "sessionEndTime": "2025-01-19T15:04:30Z"
    },
    {
      "gameType": "flags",
      "correctAnswers": 9,
      "wrongAnswers": 1,
      "sessionStartTime": "2025-01-19T16:00:00Z",
      "sessionEndTime": "2025-01-19T16:03:45Z"
    }
  ]
}

### 21. Test saving game session with invalid data
POST {{GeoQuizApi_HostAddress}}/api/game-stats
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "gameType": "",
  "correctAnswers": -1,
  "wrongAnswers": -2,
  "sessionStartTime": "2025-01-20T10:00:00Z"
}

### 22. Test accessing game stats without authentication
GET {{GeoQuizApi_HostAddress}}/api/game-stats/me
Accept: application/json

### 23. Test migrating empty anonymous sessions
POST {{GeoQuizApi_HostAddress}}/api/game-stats/migrate
Authorization: Bearer {{jwtToken}}
Content-Type: application/json

{
  "anonymousSessions": []
}