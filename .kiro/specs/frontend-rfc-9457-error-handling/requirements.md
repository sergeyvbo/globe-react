# Requirements Document

## Introduction

Данная функция направлена на обновление фронтенда для правильной обработки сообщений об ошибках в формате RFC 9457, которые теперь возвращает backend API. Backend уже был обновлен для соответствия стандарту RFC 9457, но фронтенд все еще ожидает старый формат ошибок с полями `Error`, `Timestamp`, `Path`. Необходимо обновить все HTTP клиенты и компоненты обработки ошибок для работы с новым форматом.

Текущий фронтенд использует собственные классы ошибок (`AuthServiceError`, `GameStatsApiError`, `LeaderboardApiError`) и парсит ошибки в старом формате. Новый формат RFC 9457 содержит поля `type`, `title`, `status`, `detail`, `instance`, и для ошибок валидации - дополнительное поле `errors`.

## Requirements

### Requirement 1

**User Story:** Как пользователь, я хочу видеть правильные сообщения об ошибках при регистрации и входе в систему, чтобы понимать, что именно пошло не так и как это исправить.

#### Acceptance Criteria

1. WHEN backend возвращает ошибку валидации в формате RFC 9457 THEN фронтенд SHALL правильно парсить поле `errors` и отображать конкретные ошибки для каждого поля формы
2. WHEN backend возвращает ошибку аутентификации в формате RFC 9457 THEN фронтенд SHALL отображать соответствующее сообщение об ошибке на основе поля `type`
3. WHEN backend возвращает ошибку конфликта (пользователь уже существует) THEN фронтенд SHALL отображать понятное сообщение пользователю

### Requirement 2

**User Story:** Как пользователь, я хочу видеть правильные сообщения об ошибках при загрузке статистики и таблицы лидеров, чтобы понимать причину проблем с загрузкой данных.

#### Acceptance Criteria

1. WHEN API статистики возвращает ошибку в формате RFC 9457 THEN фронтенд SHALL правильно обработать ошибку и отобразить соответствующее сообщение
2. WHEN API таблицы лидеров возвращает ошибку в формате RFC 9457 THEN фронтенд SHALL правильно обработать ошибку и отобразить соответствующее сообщение
3. WHEN происходит ошибка истечения токена THEN фронтенд SHALL правильно определить тип ошибки по полю `type` и предложить пользователю войти заново

### Requirement 3

**User Story:** Как разработчик, я хочу иметь централизованную обработку ошибок RFC 9457, чтобы все HTTP клиенты использовали единый подход к парсингу и обработке ошибок.

#### Acceptance Criteria

1. WHEN любой HTTP клиент получает ошибку от API THEN он SHALL использовать единую функцию для парсинга RFC 9457 формата
2. WHEN создается новый HTTP клиент THEN он SHALL автоматически поддерживать RFC 9457 формат без дополнительной настройки
3. WHEN обрабатывается ошибка RFC 9457 THEN система SHALL правильно извлекать тип ошибки из поля `type` (независимо от базового URL) и сопоставлять его с существующими `AuthErrorType`

### Requirement 4

**User Story:** Как разработчик, я хочу чтобы существующие типы ошибок (`AuthErrorType`) корректно сопоставлялись с типами ошибок RFC 9457, чтобы сохранить совместимость с существующим кодом обработки ошибок.

#### Acceptance Criteria

1. WHEN backend возвращает `type` содержащий "validation-error" THEN фронтенд SHALL сопоставить это с `AuthErrorType.VALIDATION_ERROR`
2. WHEN backend возвращает `type` содержащий "authentication-error" AND статус 401 THEN фронтенд SHALL сопоставить это с `AuthErrorType.TOKEN_EXPIRED`
3. WHEN backend возвращает `type` содержащий "authentication-error" AND статус 400 THEN фронтенд SHALL сопоставить это с `AuthErrorType.INVALID_CREDENTIALS`
4. WHEN backend возвращает `type` содержащий "conflict-error" THEN фронтенд SHALL сопоставить это с `AuthErrorType.USER_EXISTS`
5. WHEN backend возвращает `type` содержащий "not-found-error" THEN фронтенд SHALL сопоставить это с соответствующим типом ошибки
6. WHEN backend возвращает неизвестный тип ошибки THEN фронтенд SHALL использовать `AuthErrorType.NETWORK_ERROR` как fallback

### Requirement 5

**User Story:** Как пользователь, я хочу видеть детализированные сообщения об ошибках валидации при регистрации, чтобы точно знать, какие поля нужно исправить и как.

#### Acceptance Criteria

1. WHEN backend возвращает ошибки валидации для нескольких полей THEN фронтенд SHALL отображать ошибки под соответствующими полями формы
2. WHEN backend возвращает ошибку валидации email THEN фронтенд SHALL отображать конкретное сообщение об ошибке под полем email
3. WHEN backend возвращает ошибку валидации пароля THEN фронтенд SHALL отображать конкретное сообщение об ошибке под полем пароля
4. WHEN backend возвращает множественные ошибки валидации THEN фронтенд SHALL отображать все ошибки одновременно

### Requirement 6

**User Story:** Как разработчик, я хочу чтобы существующие тесты продолжали работать после обновления обработки ошибок, чтобы обеспечить стабильность системы.

#### Acceptance Criteria

1. WHEN выполняются существующие unit тесты THEN они SHALL успешно проходить с новой логикой обработки ошибок RFC 9457
2. WHEN выполняются тесты компонентов аутентификации THEN они SHALL корректно обрабатывать моки ошибок в формате RFC 9457
3. WHEN выполняются тесты HTTP клиентов THEN они SHALL корректно парсить и обрабатывать ошибки в новом формате